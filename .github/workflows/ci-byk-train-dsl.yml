name: Buerokratt DSL

on:
  push:
    branches:
      - dev-tmp-train # Adjust the branch name if needed
    # Remove paths filter to trigger on any change
    paths:
       - '.env.train'

jobs:
  setup_directories:
    runs-on: ubuntu-22.04

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Check and Create Folder Structure and copy DSLs for Ruuter v2 private
        run: |
          FOLDER_PATH=Ruuter/private/v2/
          if [ ! -d "$FOLDER_PATH" ]; then
            echo "Folder structure does not exist, creating..."
            mkdir -p "$FOLDER_PATH"
            touch "$FOLDER_PATH/README.yml"
          else
            echo "Folder structure already exists."
          fi

          SUBFOLDERS=("training")
          for folder in "${SUBFOLDERS[@]}"; do
            SUBFOLDER_PATH="$FOLDER_PATH$folder"
            if [ ! -d "$SUBFOLDER_PATH" ]; then
              echo "Creating $folder folder..."
              mkdir -p "$SUBFOLDER_PATH"
              touch "$SUBFOLDER_PATH/readme.yml"
              echo "Creating GET $folder ..."
              mkdir -p "$SUBFOLDER_PATH/GET"
              touch "$SUBFOLDER_PATH/GET/readme.yml"
            else
              echo "$folder folder already exists."
            fi
          done

          SOURCE_REPO_TRAINING=buerokratt/Training-Module
          SOURCE_FOLDER_TRAINING=DSL/Ruuter.private
          git clone --depth=1 --branch=dev "https://github.com/$SOURCE_REPO_TRAINING.git" source-repo-training
          cp -R "source-repo-training/$SOURCE_FOLDER_TRAINING/." "$FOLDER_PATH/training"

      - name: Clean Up Cloned Repositories
        run: |
          rm -rf source-repo-training

      - name: Check and Create Folder Structure and copy DSLs for RESQL
        run: |
          FOLDER_PATH=Resql/
          if [ ! -d "$FOLDER_PATH" ]; then
            echo "Folder structure does not exist, creating..."
            mkdir -p "$FOLDER_PATH"
            touch "$FOLDER_PATH/readme.yml"
          else
            echo "Folder structure already exists."
          fi

          SUBFOLDERS=("training")
          for folder in "${SUBFOLDERS[@]}"; do
            SUBFOLDER_PATH="$FOLDER_PATH$folder"
            if [ ! -d "$SUBFOLDER_PATH" ]; then
              echo "Creating $folder folder..."
              mkdir -p "$SUBFOLDER_PATH/GET"
              touch "$SUBFOLDER_PATH/GET/readme.yml"
            else
              echo "$folder folder already exists."
            fi
          done

          SOURCE_REPO_TRAINING=buerokratt/Training-Module
          SOURCE_FOLDER_TRAINING=DSL/Resql/training
          SOURCE_FOLDER_TRAINING_SERVICE=DSL/Resql/service
          SOURCE_FOLDER_TRAINING_USERS=DSL/Resql/service
          git clone --depth=1 --branch=dev "https://github.com/$SOURCE_REPO_TRAINING.git" source-repo-training
          cp -R "source-repo-training/$SOURCE_FOLDER_TRAINING/." "$FOLDER_PATH/training/POST"
          cp -R "source-repo-training/$SOURCE_FOLDER_TRAINING_SERVICE/." "$FOLDER_PATH/training/POST"
          cp -R "source-repo-training/$SOURCE_FOLDER_TRAINING_USERS/." "$FOLDER_PATH/training/POST"



      - name: Clean Up Cloned Repositories
        run: |
          rm -rf source-repo-training

      - name: Check and Create Folder Structure and copy DSLs for DATAMAPPER v1
        run: |
          FOLDER_PATH=DataMapper/v1/
          if [ ! -d "$FOLDER_PATH" ]; then
            echo "Folder structure does not exist, creating..."
            mkdir -p "$FOLDER_PATH"
            touch "$FOLDER_PATH/readme.yml"
          else
            echo "Folder structure already exists."
          fi

          SUBFOLDERS=("training")
          for folder in "${SUBFOLDERS[@]}"; do
            SUBFOLDER_PATH="$FOLDER_PATH$folder"
            if [ ! -d "$SUBFOLDER_PATH" ]; then
              echo "Creating $folder folder..."
              mkdir -p "$SUBFOLDER_PATH"
              touch "$SUBFOLDER_PATH/readme.yml"
            else
              echo "$folder folder already exists."
            fi
          done

          SOURCE_REPO_TRAINING=varmoh/Training-Module
          SOURCE_FOLDER_TRAINING=DSL/DataMapper
          git clone --depth=1 --branch=dev "https://github.com/$SOURCE_REPO_TRAINING.git" source-repo-training
          cp -R "source-repo-training/$SOURCE_FOLDER_TRAINING/." "$FOLDER_PATH/training/hbs"

      - name: Clean Up Cloned Repositories
        run: |
          rm -rf source-repo-training

      - name: Check and Create Folder Structure and copy DSLs for Liquibase
        run: |
          FOLDER_PATH=Liquibase/
          if [ ! -d "$FOLDER_PATH" ]; then
            echo "Folder structure does not exist, creating..."
            mkdir -p "$FOLDER_PATH"
            touch "$FOLDER_PATH/readme.yml"
          else
            echo "Folder structure already exists."
          fi

          SUBFOLDERS=("training")
          for folder in "${SUBFOLDERS[@]}"; do
            SUBFOLDER_PATH="$FOLDER_PATH$folder"
            if [ ! -d "$SUBFOLDER_PATH" ]; then
              echo "Creating $folder folder..."
              mkdir -p "$SUBFOLDER_PATH"
              touch "$SUBFOLDER_PATH/readme.yml"
            else
              echo "$folder folder already exists."
            fi
          done

          SOURCE_REPO_TRAINING=buerokratt/Training-Module
          SOURCE_FOLDER_TRAINING=DSL/Liquibase
          git clone --depth=1 --branch=dev "https://github.com/$SOURCE_REPO_TRAINING.git" source-repo-training
          cp -R "source-repo-training/$SOURCE_FOLDER_TRAINING/." "$FOLDER_PATH/training"

      - name: Clean Up Cloned Repositories
        run: |
          rm -rf source-repo-training

      - name: Check and Create Folder Structure and copy DSLs for OpenSearch
        run: |
          FOLDER_PATH=OpenSearch/
          if [ ! -d "$FOLDER_PATH" ]; then
            echo "Folder structure does not exist, creating..."
            mkdir -p "$FOLDER_PATH"
            touch "$FOLDER_PATH/readme.yml"
          else
            echo "Folder structure already exists."
          fi

          SUBFOLDERS=("training")
          for folder in "${SUBFOLDERS[@]}"; do
            SUBFOLDER_PATH="$FOLDER_PATH$folder"
            if [ ! -d "$SUBFOLDER_PATH" ]; then
              echo "Creating $folder folder..."
              mkdir -p "$SUBFOLDER_PATH"
              touch "$SUBFOLDER_PATH/readme.yml"
            else
              echo "$folder folder already exists."
            fi
          done

          SOURCE_REPO_TRAINING=buerokratt/Training-Module
          SOURCE_FOLDER_TRAINING=DSL/OpenSearch
          git clone --depth=1 --branch=dev "https://github.com/$SOURCE_REPO_TRAINING.git" source-repo-training
          cp -R "source-repo-training/$SOURCE_FOLDER_TRAINING/." "$FOLDER_PATH/training"

      - name: Clean Up Cloned Repositories
        run: |
          rm -rf source-repo-training

      - name: Commit and Push Folder Structure with Copied Contents
        run: |
          git config --local user.email "actions@github.com"
          git config --local user.name "GitHub Actions"
          git restore .
          git add -A .
          git commit --amend --no-edit
          git pull origin dev-tmp-train --rebase
          git push
